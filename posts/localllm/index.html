<p>I like to experiment with AI agents, but I do not like to pay for cloud computing. This is why I was very interested when I first heard of <a href="https://webllm.mlc.ai">WebLLM</a>, a javascript library that allows you to run large language models (LLMs) directly in your browser using <a href="https://en.wikipedia.org/wiki/WebGPU">WebGPU</a>, with no requirement for server-side processing. In other words, you can make LLM applications for free.</p>
<p>This sounds really cool, but in this hype-plagued world I always ask myself: does it actually work?</p>
<p>I will let you try for yourself by clicking below, but bear in mind that this might make your device explode if you don't have a dedicated GPU.</p>
<div id="chatbot-container" class="hidden">
        <h1>Evil chatbot</h1>
        <p>This chatbot was made with WebLLM and LLaMA 3.2; I added the evil bits myself. The model will run locally for you! Performance might be very slow, but it is free!</p>
        <div id="chat-box">Loading model...</div>
        <input id="chat-input" type="text" style="width:80%" placeholder="Ask me something, mortal." />
        <button id="send-btn">Send</button>
</div>
<p><button id="toggle-chatbot-btn" class="primary" style="margin-top: 1rem;">Chat with an evil AI running in your browser</button></p>
<h5>My impressions</h5>
<p>If you have a very good GPU, the model will run very well, and there are probably more efficient options than the one I chose for this test. However, most devices will not have a very good GPU. So, although this is not a good general solution, it can work well in specific applications.</p>
<p>Moreover, in this test I used a model that is not too large that it would be unfeasible to run, but that is large enough to serve as a general chatbot. If you are thinking of an application that requires a small model, performance should be much better!</p>
<h5>The code</h5>
<p>WebLLM is extremely simple to set up if you know JavaScript, I am very new to the language so in my case it took around 3 hours to complete this project; still something worth trying.</p>
<p>The JavaScript code goes something like this:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// Import the MLC engine from the WebLLM CDN</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CreateMLCEngine <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"https://esm.run/@mlc-ai/web-llm"</span><span class="token punctuation">;</span>

<span class="token comment">// Get references to the HTML elements related to the chatbot (I will show the HTML later)</span>
<span class="token keyword">const</span> chatBox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"chat-box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> inputEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"chat-input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sendBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"send-btn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Initialize the model (I'm choosing llama3.2-1B)</span>
<span class="token keyword">const</span> engine <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">CreateMLCEngine</span><span class="token punctuation">(</span>
    <span class="token string">"Llama-3.2-1B-Instruct-q4f32_1-MLC"</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Show loading progress in the chat box </span>
        <span class="token function-variable function">initProgressCallback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> text<span class="token punctuation">,</span> progress <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            chatBox<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Loading (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span>progress<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%): </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Indicate that the model has finished loading</span>
chatBox<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">"Model loaded!"</span><span class="token punctuation">;</span>

<span class="token comment">// Add a click event listener to the send button in the chat, so it will run the idented </span>
<span class="token comment">// code when the button is clicked</span>
sendBtn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// Get the user's input</span>
    <span class="token keyword">const</span> question <span class="token operator">=</span> inputEl<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>question<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token comment">// Display the user's message in the chat box</span>
    chatBox<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n&lt;div class="user">&lt;strong>You:&lt;/strong> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>question<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    inputEl<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> 

    <span class="token comment">// Send the user's message to the model and get a response</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> engine<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token comment">// Provide a system prompt to set the bot's persona</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">"You are an immortal evil scientist."</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// Add the user's question</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> question <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Extract the bot's answer from the response</span>
    <span class="token keyword">const</span> answer <span class="token operator">=</span> response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content<span class="token punctuation">;</span>

    <span class="token comment">// Display the bot's response in the chat box and scroll to the last message</span>
    chatBox<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n&lt;div class="bot">&lt;strong>Bot:&lt;/strong> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>answer<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    chatBox<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> chatBox<span class="token punctuation">.</span>scrollHeight<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>And the HTML should be something like this:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chatbot-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Evil chatbot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chat-box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Loading model...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chat-input<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span>80%</span><span class="token punctuation">"</span></span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Ask me something, mortal.<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>send-btn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Send<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
